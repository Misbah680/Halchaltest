<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halchal - The Golden Standard</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Font for "Happy Camper" style -->
    <link href="https://fonts.googleapis.com/css2?family=Kaushan+Script&display=swap" rel="stylesheet">

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #eab308; }
        
        body { background-color: black; color: white; overflow-x: hidden; }

        .gold-glow:hover { box-shadow: 0 0 15px rgba(234, 179, 8, 0.3); }
        
        /* Utility for hiding views */
        .view-section { display: none; }
        .view-section.active { display: block; }

        /* Bottom Nav Plus Button Special Styling */
        .nav-plus-btn {
            transform: translateY(-20%);
            box-shadow: 0 4px 20px rgba(234, 179, 8, 0.4);
        }

        /* Custom Font Class */
        .font-happy {
            font-family: 'Kaushan Script', cursive;
        }

        /* Image Preview in Compose */
        .media-preview {
            display: none;
            margin-top: 10px;
            position: relative;
        }
        .media-preview.show {
            display: block;
        }
    </style>
</head>
<body class="font-sans antialiased text-white">

    <div class="min-h-screen flex justify-center">
        
        <!-- === LEFT SIDEBAR (Desktop Only) === -->
        <header class="hidden lg:flex w-20 xl:w-72 fixed left-0 top-0 h-full border-r border-neutral-800 flex-col justify-between p-2 xl:p-4 z-20 bg-black">
            <div class="flex flex-col space-y-2">
                <!-- Desktop Logo -->
                <div onclick="switchTab('Home')" class="p-3 w-fit rounded-full hover:bg-yellow-500/10 cursor-pointer mb-2 transition-colors">
                    <h1 class="text-4xl text-yellow-500 font-happy tracking-wider">Halchal</h1>
                </div>

                <!-- Desktop Navigation Items -->
                <nav id="desktop-nav" class="space-y-1">
                    <!-- Injected via JS -->
                </nav>

                <!-- Post Button -->
                <button onclick="openComposeModal()" class="w-full bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-3.5 rounded-full shadow-lg transition-transform transform active:scale-95 mt-4 gold-glow xl:block hidden">
                    Post
                </button>
            </div>

            <!-- User Profile Bubble -->
            <div onclick="openProfile(CURRENT_USER.handle)" class="flex items-center space-x-2 p-3 rounded-full hover:bg-neutral-900 cursor-pointer transition-colors mb-4">
                <img id="sidebar-avatar" src="" class="w-10 h-10 rounded-full border border-neutral-700">
                <div class="hidden xl:block">
                    <p id="sidebar-name" class="font-bold text-sm text-yellow-500"></p>
                    <p id="sidebar-handle" class="text-neutral-500 text-sm"></p>
                </div>
                <i data-lucide="more-horizontal" class="hidden xl:block ml-auto text-neutral-500" size="16"></i>
            </div>
        </header>

        <!-- === MAIN CONTENT === -->
        <main class="w-full lg:ml-20 xl:ml-72 max-w-2xl min-h-screen border-r border-neutral-800 pb-20 lg:pb-0">
            
            <!-- 1. HOME VIEW -->
            <div id="view-Home" class="view-section active">
                <!-- Sticky Header (Mobile Modified) -->
                <div class="sticky top-0 z-10 bg-black/90 backdrop-blur-md border-b border-neutral-800 px-4 py-3">
                    
                    <!-- Mobile Top Bar -->
                    <div class="flex justify-between items-center lg:hidden">
                        
                        <!-- Left: Full Text Logo (Happy Camper Font) -->
                        <h1 class="text-3xl text-yellow-500 font-happy tracking-wider cursor-pointer" onclick="window.scrollTo(0,0)">Halchal</h1>
                        
                        <!-- Right: Notifications ONLY (Settings Removed) -->
                        <div class="flex items-center space-x-5">
                            <div onclick="switchTab('Notifications')" class="relative cursor-pointer">
                                <i data-lucide="bell" class="w-6 h-6 text-white"></i>
                                <span class="absolute top-0 right-0 w-2 h-2 bg-yellow-500 rounded-full"></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Desktop Header Title -->
                    <div class="hidden lg:flex justify-between items-center">
                         <h2 class="text-xl font-bold text-yellow-500 cursor-pointer" onclick="window.scrollTo(0,0)">Home Feed</h2>
                         <i data-lucide="sparkles" class="w-5 h-5 text-yellow-500"></i>
                    </div>
                </div>

                <!-- Compose Box (Desktop/Top) -->
                <div class="hidden sm:flex border-b border-neutral-800 p-4 space-x-3">
                    <img id="input-avatar" src="" class="w-10 h-10 rounded-full">
                    <div class="flex-1">
                        <textarea id="post-input" class="w-full bg-transparent text-xl text-white placeholder-neutral-500 outline-none resize-none h-12 min-h-[3rem] mt-2" placeholder="What is happening?!"></textarea>
                        
                        <!-- Media Preview Container -->
                        <div id="desktop-media-preview" class="media-preview rounded-xl overflow-hidden relative">
                            <img src="https://images.unsplash.com/photo-1707343843437-caacff5cfa74?q=80&w=1000&auto=format&fit=crop" class="w-full h-48 object-cover opacity-80">
                            <button onclick="clearMedia('desktop')" class="absolute top-2 right-2 bg-black/70 rounded-full p-1 text-white hover:bg-red-500"><i data-lucide="x" class="w-4 h-4"></i></button>
                        </div>

                        <div class="flex justify-between items-center mt-3 pt-3 border-t border-neutral-800/50">
                            <div class="flex space-x-4 text-yellow-500">
                                <!-- Image Button -->
                                <button onclick="attachMedia('desktop', 'image')" class="hover:bg-yellow-500/10 p-2 rounded-full transition-colors" title="Add Image">
                                    <i data-lucide="image" class="w-5 h-5"></i>
                                </button>
                                <!-- Video Button -->
                                <button onclick="attachMedia('desktop', 'video')" class="hover:bg-yellow-500/10 p-2 rounded-full transition-colors" title="Add Video">
                                    <i data-lucide="video" class="w-5 h-5"></i>
                                </button>
                                <button class="hover:bg-yellow-500/10 p-2 rounded-full transition-colors">
                                    <i data-lucide="smile" class="w-5 h-5"></i>
                                </button>
                                <button class="hover:bg-yellow-500/10 p-2 rounded-full transition-colors">
                                    <i data-lucide="map-pin" class="w-5 h-5"></i>
                                </button>
                            </div>
                            <button id="post-btn" class="px-5 py-1.5 rounded-full font-bold text-sm bg-yellow-900/30 text-yellow-500/50 cursor-not-allowed" disabled>Post</button>
                        </div>
                    </div>
                </div>

                <!-- Feed -->
                <div id="feed" class="divide-y divide-neutral-800"></div>
            </div>

            <!-- 2. EXPLORE VIEW -->
            <div id="view-Explore" class="view-section">
                <div class="sticky top-0 z-10 bg-black/80 backdrop-blur-md border-b border-neutral-800 px-4 py-3">
                    <div class="relative group">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i data-lucide="search" class="h-5 w-5 text-neutral-500"></i>
                        </div>
                        <input type="text" placeholder="Search Halchal" class="w-full bg-neutral-900 border border-transparent focus:border-yellow-500 text-white rounded-full py-2 pl-10 pr-4 outline-none">
                    </div>
                </div>
                <div class="p-4">
                    <h2 class="text-xl font-bold mb-4 text-yellow-500">Trends for you</h2>
                    <div id="explore-feed" class="space-y-4"></div>
                    
                    <!-- Mobile Only: Who to follow section in Explore -->
                    <div class="lg:hidden mt-6 pt-6 border-t border-neutral-800">
                        <h2 class="text-xl font-bold mb-4 text-yellow-500">Who to follow</h2>
                        <div id="mobile-follow-list" class="space-y-4"></div>
                    </div>
                </div>
            </div>

            <!-- 3. NOTIFICATIONS VIEW -->
            <div id="view-Notifications" class="view-section">
                <div class="sticky top-0 z-10 bg-black/80 backdrop-blur-md border-b border-neutral-800 px-4 py-3 flex items-center space-x-4">
                     <i data-lucide="arrow-left" class="lg:hidden w-6 h-6 text-white" onclick="switchTab('Home')"></i>
                    <h2 class="text-lg font-bold text-white">Notifications</h2>
                </div>
                <!-- Mock Notifications -->
                <div class="divide-y divide-neutral-800">
                    <div class="p-4 flex space-x-3 hover:bg-neutral-900/30 transition-colors">
                        <i data-lucide="heart" class="w-8 h-8 text-pink-600 fill-pink-600"></i>
                        <div>
                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Elon" class="w-8 h-8 rounded-full mb-2">
                            <p class="text-white"><span class="font-bold">Elon Musk</span> liked your post</p>
                            <p class="text-neutral-500 text-sm mt-1">"Halchal is the future! 🚀"</p>
                        </div>
                    </div>
                    <div class="p-4 flex space-x-3 hover:bg-neutral-900/30 transition-colors">
                        <i data-lucide="user-plus" class="w-8 h-8 text-yellow-500 fill-yellow-500"></i>
                        <div>
                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Tech" class="w-8 h-8 rounded-full mb-2">
                            <p class="text-white"><span class="font-bold">TechCrunch</span> followed you</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4. MESSAGES VIEW -->
            <div id="view-Messages" class="view-section">
                <div class="sticky top-0 z-10 bg-black/80 backdrop-blur-md border-b border-neutral-800 px-4 py-3 flex justify-between items-center">
                    <h2 class="text-lg font-bold text-white">Messages</h2>
                    <i data-lucide="settings" class="w-5 h-5"></i>
                </div>
                <!-- Mock Messages -->
                <div class="divide-y divide-neutral-800">
                    <div class="p-4 flex space-x-3 hover:bg-neutral-900/30 cursor-pointer">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Naval" class="w-12 h-12 rounded-full">
                        <div class="flex-1">
                            <div class="flex justify-between">
                                <span class="font-bold text-white">Naval</span>
                                <span class="text-neutral-500 text-sm">2h</span>
                            </div>
                            <p class="text-neutral-500 text-sm truncate">Build products that people love.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 5. PROFILE VIEW -->
            <div id="view-Profile" class="view-section">
                <div class="sticky top-0 z-10 bg-black/80 backdrop-blur-md px-4 py-2 flex items-center justify-between border-b border-neutral-800">
                    <div class="flex items-center space-x-4">
                        <i data-lucide="arrow-left" class="w-5 h-5 cursor-pointer" onclick="switchTab('Home')"></i>
                        <div>
                            <h2 id="profile-header-name" class="font-bold text-lg"></h2>
                            <p class="text-xs text-neutral-500">14 posts</p>
                        </div>
                    </div>
                    <!-- Settings Button kept in Profile -->
                    <i data-lucide="settings" class="w-5 h-5 cursor-pointer"></i>
                </div>
                <!-- Hero Image -->
                <div class="h-32 bg-gradient-to-r from-yellow-700 to-black"></div>
                <div class="px-4 pb-4">
                    <div class="relative flex justify-between items-start">
                        <img id="profile-view-avatar" src="" class="w-32 h-32 rounded-full border-4 border-black -mt-16 bg-black object-cover">
                        <!-- Dynamic Button: Edit Profile OR Follow -->
                        <button id="profile-action-btn" class="mt-3 border border-neutral-500 text-white px-4 py-1.5 rounded-full font-bold hover:bg-white/10 transition-colors">
                            Edit profile
                        </button>
                    </div>
                    <div class="mt-3">
                        <div class="flex items-center gap-1">
                            <h2 id="profile-name" class="font-black text-xl text-white leading-tight"></h2>
                            <!-- Golden Tick in Profile -->
                            <span id="profile-tick" class="hidden">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#eab308" stroke="none" class="ml-1">
                                    <circle cx="12" cy="12" r="10" />
                                    <path d="M9 12l2 2 4-4" stroke="black" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                        </div>
                        <p id="profile-handle" class="text-neutral-500"></p>
                    </div>
                    <div class="mt-3 text-white">
                        <p>Building the <span class="text-yellow-500">#GoldStandard</span> of social media.</p>
                    </div>
                    <div class="flex space-x-4 mt-3 text-neutral-500 text-sm">
                        <span><b class="text-white">143</b> Following</span>
                        <span><b class="text-white">8,402</b> Followers</span>
                    </div>
                </div>
                <!-- Profile Tabs -->
                <div class="flex border-b border-neutral-800 mt-2">
                    <div class="flex-1 text-center py-3 border-b-2 border-yellow-500 font-bold text-white">Posts</div>
                    <div class="flex-1 text-center py-3 text-neutral-500 hover:bg-white/5">Replies</div>
                    <div class="flex-1 text-center py-3 text-neutral-500 hover:bg-white/5">Media</div>
                    <div class="flex-1 text-center py-3 text-neutral-500 hover:bg-white/5">Likes</div>
                </div>
                <!-- User's Posts Mock -->
                <div class="p-4 text-center text-neutral-500 py-10">
                    <p>Tweets loading...</p>
                </div>
            </div>

        </main>

        <!-- === RIGHT SIDEBAR (Desktop Only) === -->
        <aside class="hidden lg:block w-80 pl-8 py-4 pr-4 h-screen sticky top-0 overflow-y-auto border-l border-neutral-800 ml-4">
            <div class="sticky top-0 bg-black pb-2 z-10">
                <div class="relative group">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i data-lucide="search" class="h-5 w-5 text-neutral-500 group-focus-within:text-yellow-500"></i>
                    </div>
                    <input type="text" placeholder="Search Halchal" class="w-full bg-neutral-900 border border-transparent focus:border-yellow-500 text-white rounded-full py-3 pl-10 pr-4 outline-none transition-colors">
                </div>
            </div>

            <div class="bg-neutral-900 rounded-2xl mt-4 border border-neutral-800 overflow-hidden">
                <h2 class="font-bold text-xl p-4 text-white">What's happening</h2>
                <div id="trending-list"></div>
            </div>

            <div class="bg-neutral-900 rounded-2xl mt-4 border border-neutral-800 overflow-hidden">
                <h2 class="font-bold text-xl p-4 text-white">Who to follow</h2>
                <div id="follow-list"></div>
            </div>
        </aside>

        <!-- === BOTTOM NAVIGATION (Mobile Only - 5 Items) === -->
        <nav class="lg:hidden fixed bottom-0 w-full bg-black border-t border-neutral-800 pb-safe flex justify-between items-end h-16 z-50 px-6" id="mobile-nav">
            <!-- Injected via JS -->
        </nav>

        <!-- MOBILE COMPOSE MODAL -->
        <div id="compose-modal" class="fixed inset-0 bg-black z-[60] hidden flex-col">
            <!-- Modal Header (Close left, Post right) -->
            <div class="flex justify-between items-center p-4">
                <button onclick="closeComposeModal()" class="text-white hover:bg-neutral-900 rounded-full p-2">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
                <button id="modal-post-btn" onclick="submitModalPost()" class="bg-yellow-500 text-black font-bold px-5 py-1.5 rounded-full disabled:opacity-50" disabled>Post</button>
            </div>
            
            <div class="p-4 flex gap-3 flex-1 overflow-y-auto">
                <img id="modal-avatar" src="" class="w-10 h-10 rounded-full flex-shrink-0 mt-1">
                <div class="flex-1">
                    <textarea id="modal-input" class="w-full bg-transparent text-xl text-white outline-none resize-none h-32 placeholder-neutral-500 mt-2" placeholder="What is happening?!"></textarea>
                    
                    <!-- Mobile Media Preview -->
                    <div id="mobile-media-preview" class="media-preview rounded-xl overflow-hidden relative mt-2 hidden">
                        <img src="https://images.unsplash.com/photo-1707343843437-caacff5cfa74?q=80&w=1000&auto=format&fit=crop" class="w-full h-auto max-h-60 object-cover opacity-80 rounded-xl border border-neutral-800">
                        <button onclick="clearMedia('mobile')" class="absolute top-2 right-2 bg-black/70 rounded-full p-1 text-white hover:bg-red-500"><i data-lucide="x" class="w-4 h-4"></i></button>
                    </div>
                </div>
            </div>
            
            <!-- Modal Footer (Line above icons) -->
            <div class="border-t border-neutral-800 p-3 pb-8 bg-black">
                <div class="flex space-x-6 text-yellow-500 px-4">
                     <button onclick="attachMedia('mobile', 'image')" class="p-2"><i data-lucide="image" class="w-6 h-6"></i></button>
                     <button class="p-2 font-bold text-sm border border-yellow-500 rounded px-1 h-6 self-center flex items-center">GIF</button>
                     <button class="p-2"><i data-lucide="map-pin" class="w-6 h-6"></i></button>
                </div>
            </div>
        </div>

    </div>

    <!-- JAVASCRIPT -->
    <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
        // --- DATA STATE ---
        const CURRENT_USER = {
            name: "Halchal User",
            handle: "@halchal_king",
            avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Felix",
            verified: true
        };

        const USERS_DB = {
            "@halchal_king": CURRENT_USER,
            "@elonmusk": { name: "Elon Musk", handle: "@elonmusk", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Elon", verified: true },
            "@techcrunch": { name: "TechCrunch", handle: "@techcrunch", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Tech", verified: true },
            "@naval": { name: "Naval", handle: "@naval", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Naval", verified: true },
            "@vercel": { name: "Vercel", handle: "@vercel", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Vercel", verified: true },
            "@react": { name: "React Team", handle: "@react", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=React", verified: true }
        };

        const MENU_ITEMS_DESKTOP = [
            { id: 'Home', icon: 'home', label: 'Home' },
            { id: 'Explore', icon: 'search', label: 'Explore' },
            { id: 'Notifications', icon: 'bell', label: 'Notifications' },
            { id: 'Messages', icon: 'mail', label: 'Messages' },
            { id: 'Profile', icon: 'user', label: 'Profile' }
        ];

        const MENU_ITEMS_MOBILE = [
            { id: 'Home', icon: 'home' },
            { id: 'Explore', icon: 'search' },
            { id: 'COMPOSE_ACTION', icon: 'plus', isAction: true },
            { id: 'Messages', icon: 'mail' },
            { id: 'Profile', icon: 'user' }
        ];

        let activeTab = 'Home';
        let attachedMedia = null; 
        
        const TRENDING_DATA = [
            { cat: "Technology", title: "#HalchalLaunch", count: "500K" },
            { cat: "Business", title: "Gold Prices", count: "120K" },
            { cat: "Politics", title: "#Elections2024", count: "89K" },
        ];

        const FOLLOW_SUGGESTIONS = [
            { handle: "@naval" },
            { handle: "@vercel" },
            { handle: "@react" }
        ];

        let posts = [
            { 
                id: 1, 
                handle: "@elonmusk", 
                time: "2h", 
                content: "Halchal is looking insane! Just dropped this new pic from the launch event. #GoldStandard", 
                likes: 2300, 
                retweets: 400, 
                comments: 120, 
                isLiked: false, 
                image: "https://images.unsplash.com/photo-1614028674026-a65e31bfd27c?q=80&w=1000&auto=format&fit=crop" 
            },
            { 
                id: 2, 
                handle: "@techcrunch", 
                time: "4h", 
                content: "Breaking: The new Black & Gold social app is taking over. Here is the first look at the dashboard.", 
                likes: 890, 
                retweets: 120, 
                comments: 50, 
                isLiked: true, 
                image: "https://images.unsplash.com/photo-1611162617474-5b21e879e113?q=80&w=1000&auto=format&fit=crop"
            },
        ];

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            initUser();
            renderNavs();
            renderFeed();
            renderTrending();
            renderWhoToFollow();
            lucide.createIcons();

            setupInputListeners('post-input', 'post-btn');
            setupInputListeners('modal-input', 'modal-post-btn');

            document.getElementById('post-btn').addEventListener('click', () => createPost('post-input', 'post-btn', 'desktop'));
        });

        // --- FUNCTIONS ---

        function initUser() {
            const elements = ['sidebar-avatar', 'input-avatar', 'modal-avatar'];
            elements.forEach(id => {
                const el = document.getElementById(id);
                if(el) el.src = CURRENT_USER.avatar;
            });
            
            document.getElementById('sidebar-name').innerText = CURRENT_USER.name;
            document.getElementById('sidebar-handle').innerText = CURRENT_USER.handle;
        }

        function switchTab(tabId) {
            activeTab = tabId;
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(`view-${tabId}`).classList.add('active');
            window.scrollTo(0,0);
            renderNavs();
            
            if(tabId === 'Profile') {
                openProfile(CURRENT_USER.handle);
            }
            
            lucide.createIcons();
        }

        function openProfile(handle) {
            activeTab = 'Profile';
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(`view-Profile`).classList.add('active');
            window.scrollTo(0,0);
            renderNavs();
            lucide.createIcons();

            const user = USERS_DB[handle] || { name: "Unknown", handle: handle, avatar: "", verified: false };
            document.getElementById('profile-header-name').innerText = user.name;
            document.getElementById('profile-view-avatar').src = user.avatar;
            document.getElementById('profile-name').innerText = user.name;
            document.getElementById('profile-handle').innerText = user.handle;

            const tick = document.getElementById('profile-tick');
            if(user.verified) {
                tick.classList.remove('hidden');
                tick.classList.add('inline-flex', 'items-center', 'justify-center');
            } else {
                tick.classList.add('hidden');
            }

            const btn = document.getElementById('profile-action-btn');
            if (handle === CURRENT_USER.handle) {
                btn.innerText = "Edit profile";
                btn.className = "mt-3 border border-neutral-500 text-white px-4 py-1.5 rounded-full font-bold hover:bg-white/10 transition-colors";
                btn.onclick = null;
            } else {
                btn.innerText = "Follow";
                btn.className = "mt-3 bg-white text-black px-6 py-1.5 rounded-full font-bold hover:bg-neutral-200 transition-colors";
                btn.onclick = function() {
                    if(this.innerText === "Follow") {
                        this.innerText = "Following";
                        this.className = "mt-3 border border-neutral-600 text-white px-6 py-1.5 rounded-full font-bold";
                    } else {
                        this.innerText = "Follow";
                        this.className = "mt-3 bg-white text-black px-6 py-1.5 rounded-full font-bold hover:bg-neutral-200";
                    }
                };
            }
        }

        function renderNavs() {
            // Desktop
            const desktopContainer = document.getElementById('desktop-nav');
            desktopContainer.innerHTML = MENU_ITEMS_DESKTOP.map(item => {
                const isActive = activeTab === item.id;
                let iconClass = isActive ? 'text-yellow-500' : 'text-white';
                if (isActive && item.id === 'Profile') {
                     iconClass += ' fill-current';
                }

                return `
                <div onclick="switchTab('${item.id}')" class="flex items-center space-x-4 p-3 rounded-full cursor-pointer transition-colors w-fit xl:w-full hover:bg-neutral-900 group">
                    <i data-lucide="${item.icon}" class="w-7 h-7 ${iconClass} group-hover:text-yellow-500"></i>
                    <span class="hidden xl:block text-xl ${isActive ? 'text-yellow-500 font-bold' : 'text-white'} group-hover:text-yellow-500">${item.label}</span>
                </div>
            `}).join('');

            // Mobile
            const mobileContainer = document.getElementById('mobile-nav');
            mobileContainer.innerHTML = MENU_ITEMS_MOBILE.map(item => {
                if (item.isAction) {
                    return `
                    <div onclick="openComposeModal()" class="cursor-pointer mb-3">
                        <div class="bg-yellow-500 w-12 h-12 rounded-full flex items-center justify-center nav-plus-btn text-black hover:bg-yellow-400 transition-colors">
                            <i data-lucide="plus" class="w-7 h-7"></i>
                        </div>
                    </div>`;
                }
                const isActive = activeTab === item.id;
                let iconClass = isActive ? 'text-yellow-500' : 'text-white';
                if (isActive && item.id === 'Profile') {
                     iconClass += ' fill-current';
                }

                return `
                <div onclick="switchTab('${item.id}')" class="p-4 mb-1 cursor-pointer rounded-full transition-colors flex flex-col items-center justify-center">
                    <i data-lucide="${item.icon}" class="w-6 h-6 ${iconClass}"></i>
                </div>`;
            }).join('');
        }

        function renderFeed() {
            const feed = document.getElementById('feed');
            feed.innerHTML = posts.map(post => {
                const user = USERS_DB[post.handle];
                // GOLDEN TICK SVG
                const verifiedIcon = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="#eab308" stroke="none" class="ml-1 inline-block align-text-bottom">
                        <circle cx="12" cy="12" r="10" />
                        <path d="M9 12l2 2 4-4" stroke="black" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>`;

                // Conditionally render image
                const imageContent = post.image ? 
                    `<div class="mt-3 rounded-2xl overflow-hidden border border-neutral-800">
                        <img src="${post.image}" class="w-full h-auto object-cover max-h-[400px]">
                     </div>` : '';

                // UPDATED LAYOUT: Avatar in Header, No left space for text
                return `
                <div class="p-4 hover:bg-neutral-900/20 transition-colors cursor-pointer border-b border-neutral-800">
                    
                    <!-- Header Row: Avatar, Name (Larger), Handle, Time, Follow -->
                    <div class="flex justify-between items-start mb-1">
                        <div class="flex items-center gap-2" onclick="event.stopPropagation(); openProfile('${post.handle}')">
                            <img src="${user.avatar}" class="w-10 h-10 rounded-full flex-shrink-0">
                            <div class="flex flex-col">
                                <div class="flex items-center">
                                    <span class="font-black text-lg text-white leading-none mr-1">${user.name}</span>
                                    ${user.verified ? verifiedIcon : ''}
                                </div>
                                <span class="text-neutral-500 text-sm leading-none mt-0.5">${user.handle} · ${post.time}</span>
                            </div>
                        </div>
                        
                        ${post.handle !== CURRENT_USER.handle ? 
                            `<button onclick="event.stopPropagation(); toggleFollowBtn(this)" class="text-sm font-bold bg-white text-black px-4 w-24 py-1.5 rounded-full hover:bg-neutral-200 transition-colors">Follow</button>` 
                            : ''}
                    </div>

                    <!-- Content (Starts from Left - No Indent) -->
                    <div class="mt-1">
                        <p class="text-white text-[16px] leading-snug">${post.content}</p>
                    </div>

                    ${imageContent}
                    
                    <!-- ACTIONS: Larger, High Contrast, White Numbers -->
                    <div class="flex justify-between mt-3 text-neutral-500 max-w-full px-2">
                        
                        <!-- 1. LIKE -->
                        <div onclick="toggleLike(${post.id})" class="flex items-center space-x-1 group hover:text-pink-600 ${post.isLiked ? 'text-pink-600' : ''}">
                            <i data-lucide="heart" class="w-7 h-7 ${post.isLiked ? 'fill-current' : ''}"></i>
                            <span class="font-bold text-white text-base">${post.likes}</span>
                        </div>

                        <!-- 2. COMMENT -->
                        <div class="flex items-center space-x-1 group hover:text-blue-400">
                            <i data-lucide="message-circle" class="w-7 h-7"></i>
                            <span class="font-bold text-white text-base">${post.comments}</span>
                        </div>

                        <!-- 3. REPOST -->
                        <div class="flex items-center space-x-1 group hover:text-green-500">
                            <i data-lucide="repeat" class="w-7 h-7"></i>
                            <span class="font-bold text-white text-base">${post.retweets}</span>
                        </div>

                        <!-- 4. SHARE -->
                        <div class="group flex items-center hover:text-yellow-500">
                            <i data-lucide="share-2" class="w-7 h-7"></i>
                        </div>
                        
                    </div>
                </div>
            `}).join('');
            lucide.createIcons();
        }

        function renderTrending() {
            const html = TRENDING_DATA.map(t => `
                <div class="px-4 py-3 hover:bg-white/5 cursor-pointer relative">
                    <div class="flex justify-between text-xs text-neutral-500"><span>${t.cat}</span><i data-lucide="more-horizontal" class="w-3 h-3"></i></div>
                    <p class="font-bold text-white mt-0.5">${t.title}</p>
                    <p class="text-xs text-neutral-500 mt-1">${t.count} posts</p>
                </div>
            `).join('');
            document.getElementById('trending-list').innerHTML = html;
            document.getElementById('explore-feed').innerHTML = html;
        }

        function renderWhoToFollow() {
            const generateHTML = (list) => list.map(item => {
                const p = USERS_DB[item.handle];
                return `
                <div class="px-4 py-3 hover:bg-white/5 cursor-pointer flex items-center justify-between">
                    <div class="flex items-center space-x-3" onclick="openProfile('${p.handle}')">
                        <img src="${p.avatar}" class="w-10 h-10 rounded-full">
                        <div>
                            <p class="font-bold text-white text-sm hover:underline">${p.name}</p>
                            <p class="text-neutral-500 text-sm">${p.handle}</p>
                        </div>
                    </div>
                    <button onclick="toggleFollowBtn(this)" class="px-4 py-1.5 rounded-full font-bold text-sm bg-white text-black hover:bg-yellow-500 transition-colors">Follow</button>
                </div>`;
            }).join('');

            document.getElementById('follow-list').innerHTML = generateHTML(FOLLOW_SUGGESTIONS);
            document.getElementById('mobile-follow-list').innerHTML = generateHTML(FOLLOW_SUGGESTIONS);
        }

        // --- MEDIA ATTACHMENT LOGIC ---
        function attachMedia(context, type) {
            // Simulate file attachment
            attachedMedia = "https://images.unsplash.com/photo-1707343843437-caacff5cfa74?q=80&w=1000&auto=format&fit=crop"; 
            
            // Show preview based on context
            if(context === 'desktop') {
                document.getElementById('desktop-media-preview').classList.remove('hidden');
                document.getElementById('desktop-media-preview').classList.add('block');
            } else {
                document.getElementById('mobile-media-preview').classList.remove('hidden');
                document.getElementById('mobile-media-preview').classList.add('block');
            }

            // Enable post button if it wasn't already
            const btnId = context === 'desktop' ? 'post-btn' : 'modal-post-btn';
            const btn = document.getElementById(btnId);
            btn.classList.replace('bg-yellow-900/30', 'bg-yellow-500');
            btn.classList.replace('text-yellow-500/50', 'text-black');
            btn.classList.remove('cursor-not-allowed');
            btn.disabled = false;
        }

        function clearMedia(context) {
            attachedMedia = null;
            if(context === 'desktop') {
                document.getElementById('desktop-media-preview').classList.add('hidden');
            } else {
                document.getElementById('mobile-media-preview').classList.add('hidden');
            }
            // Check text input to see if button should remain enabled
            const inputId = context === 'desktop' ? 'post-input' : 'modal-input';
            const btnId = context === 'desktop' ? 'post-btn' : 'modal-post-btn';
            const val = document.getElementById(inputId).value.trim();
            if(val.length === 0) {
                 const btn = document.getElementById(btnId);
                 btn.classList.replace('bg-yellow-500', 'bg-yellow-900/30');
                 btn.classList.replace('text-black', 'text-yellow-500/50');
                 btn.classList.add('cursor-not-allowed');
                 btn.disabled = true;
            }
        }

        // --- INTERACTIONS ---

        function setupInputListeners(inputId, btnId) {
            const input = document.getElementById(inputId);
            input.addEventListener('input', (e) => {
                const btn = document.getElementById(btnId);
                const hasText = e.target.value.trim().length > 0;
                
                if(hasText || attachedMedia) {
                    btn.classList.replace('bg-yellow-900/30', 'bg-yellow-500');
                    btn.classList.replace('text-yellow-500/50', 'text-black');
                    btn.classList.remove('cursor-not-allowed');
                    btn.disabled = false;
                } else {
                    btn.classList.replace('bg-yellow-500', 'bg-yellow-900/30');
                    btn.classList.replace('text-black', 'text-yellow-500/50');
                    btn.classList.add('cursor-not-allowed');
                    btn.disabled = true;
                }
            });
        }

        async function createPost(inputId, btnId, context) {
            const input = document.getElementById(inputId);
            const txt = input.value.trim();
            
            if(!txt && !attachedMedia) return;
            try {
  await addDoc(collection(db, "posts"), {
    text: txt,
    user: CURRENT_USER.handle,
    name: CURRENT_USER.name,
    avatar: CURRENT_USER.avatar,
    createdAt: serverTimestamp()
  });
} catch (e) {
  alert("Post failed");
  console.error(e);
  return;
}

            posts.unshift({
                id: Date.now(),
                handle: CURRENT_USER.handle,
                time: "Now",
                content: txt,
                likes: 0, retweets: 0, comments: 0, isLiked: false,
                image: attachedMedia
            });
            input.value = "";
            clearMedia(context); // Resets attachedMedia and hides preview
            renderFeed();
            
            const btn = document.getElementById(btnId);
            btn.classList.replace('bg-yellow-500', 'bg-yellow-900/30');
            btn.classList.replace('text-black', 'text-yellow-500/50');
            btn.disabled = true;

            if(inputId === 'modal-input') {
                closeComposeModal();
                switchTab('Home');
            }
        }

        function toggleLike(id) {
            const p = posts.find(x => x.id === id);
            if(p) {
                p.isLiked = !p.isLiked;
                p.likes += p.isLiked ? 1 : -1;
                renderFeed();
            }
        }

        function toggleFollowBtn(btn) {
            if(btn.innerText === "Follow") {
                btn.innerText = "Following";
                btn.className = "text-sm font-bold border border-neutral-600 text-white px-4 w-24 py-1.5 rounded-full";
            } else {
                btn.innerText = "Follow";
                btn.className = "text-sm font-bold bg-white text-black px-4 w-24 py-1.5 rounded-full hover:bg-neutral-200";
            }
        }

        function openComposeModal() {
            document.getElementById('compose-modal').classList.remove('hidden');
            document.getElementById('compose-modal').classList.add('flex');
            document.getElementById('modal-input').focus();
        }
        function closeComposeModal() {
            document.getElementById('compose-modal').classList.add('hidden');
            document.getElementById('compose-modal').classList.remove('flex');
            clearMedia('mobile');
        }
        function submitModalPost() {
            createPost('modal-input', 'modal-post-btn', 'mobile');
        }
const firebaseConfig = {
    apiKey: "AIzaSyAJxOlGg26nOifAqFubGEpXso_jYrYBDNg",
    authDomain: "halchal-01.firebaseapp.com",
    projectId: "halchal-01",
    storageBucket: "halchal-01.firebasestorage.app",
    messagingSenderId: "966101794886",
    appId: "1:966101794886:web:2eaf8c9746682d2aa38a47",
    measurementId: "G-60QNM1DNCJ"
  };
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

    </script>
</body>
</html>


